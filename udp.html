
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>User-Defined Processes &#8212; openEO Python Client 0.6.2a1 documentation</title>
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/alabaster.css" type="text/css" />
    <script id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Authentication and Account Management" href="auth.html" />
    <link rel="prev" title="Batch Jobs" href="batch_jobs.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="index.html">openEO Python Client</a></h1>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=Open-EO&repo=openeo-python-client&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





    

<p>
<a class="badge" href="https://travis-ci.org/Open-EO/openeo-python-client">
    <img
        alt="https://secure.travis-ci.org/Open-EO/openeo-python-client.svg?branch=master"
        src="https://secure.travis-ci.org/Open-EO/openeo-python-client.svg?branch=master"
    />
</a>
</p>



  <h3><a href="index.html">Table of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">User-Defined Processes</a><ul>
<li><a class="reference internal" href="#code-reuse-with-user-defined-processes">Code reuse with user-defined processes</a></li>
<li><a class="reference internal" href="#process-parameters">Process Parameters</a><ul>
<li><a class="reference internal" href="#declaring-parameters">Declaring Parameters</a></li>
<li><a class="reference internal" href="#parameter-schema">Parameter schema</a><ul>
<li><a class="reference internal" href="#schema-specific-helpers">Schema-specific helpers</a></li>
</ul>
</li>
</ul>
</li>
<li><a class="reference internal" href="#building-and-storing-user-defined-process">Building and storing user-defined process</a><ul>
<li><a class="reference internal" href="#through-process-functions">Through “process functions”</a></li>
<li><a class="reference internal" href="#from-a-parameterized-data-cube">From a parameterized data cube</a></li>
<li><a class="reference internal" href="#using-a-predefined-dictionary">Using a predefined dictionary</a></li>
<li><a class="reference internal" href="#store-to-a-file">Store to a file</a></li>
</ul>
</li>
<li><a class="reference internal" href="#evaluate-user-defined-processes">Evaluate user-defined processes</a></li>
<li><a class="reference internal" href="#public-user-defined-processes">Public user-defined processes</a></li>
</ul>
</li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
      <li>Previous: <a href="batch_jobs.html" title="previous chapter">Batch Jobs</a></li>
      <li>Next: <a href="auth.html" title="next chapter">Authentication and Account Management</a></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" />
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script><!-- Alabaster (krTheme++) Hacks -->

<div class="sidebar-meta">
<h3>Meta</h3>
<div>Docs for openEO Python Client</div>
<div>Version: <code>0.6.2a1</code></div>
<div>Last updated: 2021/04/01</div>
</div>

<!-- CSS Adjustments from requests: https://github.com/kennethreitz/requests/blob/master/docs/_templates/hacks.html -->
<style type="text/css">
  /* Rezzy requires precise alignment. */
  img.logo {margin-left: -20px!important;}
  /* "Quick Search" should be capitalized. */
  div#searchbox h3 {text-transform: capitalize;}
  /* Make the document a little wider, less code is cut-off. */
  div.document {width: 1008px;}
  /* Much-improved spacing around code blocks. */
  div.highlight pre {padding: 11px 14px;}
  /* Remain Responsive! */
  @media screen and (max-width: 1008px) {
    div.sphinxsidebar {display: none;}
    div.document {width: 100%!important;}
    /* Have code blocks escape the document right-margin. */
    div.highlight pre {margin-right: -30px;}
  }

  /* Reduce space between paragraphs for better visual structure */
  p { margin: 1ex 0; }

  /* Hide "view source code" links by default, only show on hover */
  dt .viewcode-link { visibility: hidden; font-size: 70%; }
  dt:hover .viewcode-link { visibility: visible; }

  /* More breathing space between successive methods */
  dl { margin-bottom: 1.5em; }

  dl.field-list > dt {
      /* Cleaner aligning of Parameters/Returns/Raises listing with method description paragraphs */
      padding-left: 0;
      /* Make Parameters/Returns/Raises labels less dominant */
      text-transform: uppercase;
      font-size: 70%;
  }

  .sidebar-meta {
      font-size: 80%;
  }

</style>
        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="user-defined-processes">
<span id="id1"></span><h1>User-Defined Processes<a class="headerlink" href="#user-defined-processes" title="Permalink to this headline">¶</a></h1>
<div class="section" id="code-reuse-with-user-defined-processes">
<h2>Code reuse with user-defined processes<a class="headerlink" href="#code-reuse-with-user-defined-processes" title="Permalink to this headline">¶</a></h2>
<p>As explained before, processes can be chained together in a process graph
to build a certain algorithm.
Often, you have certain (sub)chains that reoccur in the same process graph
of even in different process graphs or algorithms.</p>
<p>The openEO API enables you to store such (sub)chains
on the backend as a so called <strong>user-defined process</strong>.
This allows you to build your own <em>library of reusable building blocks</em>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Don not confuse user-defined processes (sometimes abbreviated as UDP) with
<strong>user-defined functions</strong> (UDF) in openEO, which is a mechanism to
inject Python or R scripts as process nodes in a process graph.
see <a class="reference internal" href="udf.html#user-defined-functions"><span class="std std-ref">User-Defined Functions (UDF) explained</span></a> for more information.</p>
</div>
<p>A user-defined process can not only be constructed from
pre-defined processes provided by the backend,
but also other user-defined processes.</p>
<p>Ultimately, the openEO API allows you to publicly expose your user-defined process,
so that other users can invoke it as a service.
This turns your openEO process into a web application
that can be executed using the regular openEO
support for synchronous and asynchronous jobs.</p>
</div>
<div class="section" id="process-parameters">
<h2>Process Parameters<a class="headerlink" href="#process-parameters" title="Permalink to this headline">¶</a></h2>
<p>User-defined processes are usually <strong>parameterized</strong>,
meaning certain inputs are expected when calling the process.</p>
<p>For example, if you often have to convert Fahrenheit to Celsius:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span> <span class="o">-</span> <span class="mi">32</span><span class="p">)</span> <span class="o">/</span> <span class="mf">1.8</span>
</pre></div>
</div>
<p>you could define a user-defined process <code class="docutils literal notranslate"><span class="pre">fahrenheit_to_celsius</span></code>,
consisting of two simple mathematical operations
(pre-defined processes <code class="docutils literal notranslate"><span class="pre">subtract</span></code> and <code class="docutils literal notranslate"><span class="pre">divide</span></code>).</p>
<p>We can represent this in openEO’s JSON based format as follows
(don’t worry too much about the syntax details of this representation,
the openEO Python client will hide this normally):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;subtract32&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;subtract&quot;</span><span class="p">,</span>
        <span class="s2">&quot;arguments&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;from_parameter&quot;</span><span class="p">:</span> <span class="s2">&quot;fahrenheit&quot;</span><span class="p">},</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">32</span><span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;divide18&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;divide&quot;</span><span class="p">,</span>
        <span class="s2">&quot;arguments&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;from_node&quot;</span><span class="p">:</span> <span class="s2">&quot;subtract32&quot;</span><span class="p">},</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mf">1.8</span><span class="p">},</span>
        <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="n">true</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The important point here is the parameter reference <code class="docutils literal notranslate"><span class="pre">{&quot;from_parameter&quot;:</span> <span class="pre">&quot;fahrenheit&quot;}</span></code> in the subtraction.
When we call this user-defined process we will have to provide a Fahrenheit value.
For example with 70 degrees Fahrenheit (again in openEO JSON format here):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;fahrenheit_to_celsius&quot;</span><span class="p">,</span>
    <span class="s2">&quot;arguments&quot;</span> <span class="p">{</span><span class="s2">&quot;fahrenheit&quot;</span><span class="p">:</span> <span class="mi">70</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="declaring-parameters">
<h3>Declaring Parameters<a class="headerlink" href="#declaring-parameters" title="Permalink to this headline">¶</a></h3>
<p>It’s good style to declare what parameters your user-defined process expects and supports.
It allows you to document your parameters, define the data type(s) you expect
(the “schema” in openEO-speak) and define default values.</p>
<p>The openEO Python client lets you define parameters as
<a class="reference internal" href="api.html#openeo.api.process.Parameter" title="openeo.api.process.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a> instances.
In general you have to specify at least the parameter name,
a description and a schema.
The “fahrenheit” parameter from the example above can be defined like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">openeo.api.process</span> <span class="kn">import</span> <span class="n">Parameter</span>

<span class="n">fahrenheit_param</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;fahrenheit&quot;</span><span class="p">,</span>
    <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Degrees Fahrenheit&quot;</span><span class="p">,</span>
    <span class="n">schema</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;number&quot;</span><span class="p">}</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="parameter-schema">
<h3>Parameter schema<a class="headerlink" href="#parameter-schema" title="Permalink to this headline">¶</a></h3>
<p>The “schema” argument defines the data type of values that will be passed for this parameter.
It is based on <a class="reference external" href="https://json-schema.org/">JSON Schema draft-07</a>,
which defines the usual suspects:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">{&quot;type&quot;:</span> <span class="pre">&quot;string&quot;}</span></code> for strings</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{&quot;type&quot;:</span> <span class="pre">&quot;integer&quot;}</span></code> for integers</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{&quot;type&quot;:</span> <span class="pre">&quot;number&quot;}</span></code> for general numeric types (integers and floats)</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">{&quot;type&quot;:</span> <span class="pre">&quot;boolean&quot;}</span></code> for booleans</p></li>
</ul>
<p>Apart from these basic primitives, one can also define arrays with <code class="docutils literal notranslate"><span class="pre">{&quot;type&quot;:</span> <span class="pre">&quot;array&quot;}</span></code>,
or even specify the expected type of the array items, e.g. an array of integers as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;array&quot;</span><span class="p">,</span>
    <span class="s2">&quot;items&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Another more complex type is <code class="docutils literal notranslate"><span class="pre">{&quot;type&quot;:</span> <span class="pre">&quot;object&quot;}</span></code> for parameters
that are like Python dictionaries (or mappings).
For example, to define a bounding box parameter
that should contain certain fields with certain type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
    <span class="s2">&quot;properties&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;west&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;number&quot;</span><span class="p">},</span>
        <span class="s2">&quot;south&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;number&quot;</span><span class="p">},</span>
        <span class="s2">&quot;east&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;number&quot;</span><span class="p">},</span>
        <span class="s2">&quot;north&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;number&quot;</span><span class="p">},</span>
        <span class="s2">&quot;crs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;string&quot;</span><span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Check the documentation and examples of <a class="reference external" href="https://json-schema.org/">JSON Schema draft-07</a>
for even more features.</p>
<p>On top of these generic types, openEO defines a couple of custom types,
most notably the <strong>data cube</strong> type:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
    <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="s2">&quot;object&quot;</span><span class="p">,</span>
    <span class="s2">&quot;subtype&quot;</span><span class="p">:</span> <span class="s2">&quot;raster-cube&quot;</span>
<span class="p">}</span>
</pre></div>
</div>
<div class="section" id="schema-specific-helpers">
<h4>Schema-specific helpers<a class="headerlink" href="#schema-specific-helpers" title="Permalink to this headline">¶</a></h4>
<p>The openEO Python client defines some helper functions
to create parameters with a given schema in a compact way.
For example, the “fahrenheit” parameter, which is of type “number”,
can be created with the <a class="reference internal" href="api.html#openeo.api.process.Parameter.number" title="openeo.api.process.Parameter.number"><code class="xref py py-func docutils literal notranslate"><span class="pre">number()</span></code></a> helper:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fahrenheit_param</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">number</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;fahrenheit&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Degrees Fahrenheit&quot;</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Very often you will need a “raster-cube” type parameter,
easily created with the <a class="reference internal" href="api.html#openeo.api.process.Parameter.raster_cube" title="openeo.api.process.Parameter.raster_cube"><code class="xref py py-func docutils literal notranslate"><span class="pre">raster_cube()</span></code></a> helper:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cube_param</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">raster_cube</span><span class="p">()</span>
</pre></div>
</div>
<p>Another example of an integer parameter with a default value:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">size_param</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">integer</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;size&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Kernel size&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">4</span>
<span class="p">)</span>
</pre></div>
</div>
<p>How you have to use these parameter instances will be explained below.</p>
</div>
</div>
</div>
<div class="section" id="building-and-storing-user-defined-process">
<h2>Building and storing user-defined process<a class="headerlink" href="#building-and-storing-user-defined-process" title="Permalink to this headline">¶</a></h2>
<p>There are a couple of ways to build and store user-defined processes:</p>
<ul class="simple">
<li><p>using predefined <a class="reference internal" href="#create-udp-through-process-functions"><span class="std std-ref">process functions</span></a></p></li>
<li><p><a class="reference internal" href="#create-udp-parameterized-cube"><span class="std std-ref">parameterized building of a data cube</span></a></p></li>
<li><p><a class="reference internal" href="#create-udp-from-dict"><span class="std std-ref">directly from a well-formatted dictionary</span></a> process graph representation</p></li>
</ul>
<div class="section" id="through-process-functions">
<span id="create-udp-through-process-functions"></span><h3>Through “process functions”<a class="headerlink" href="#through-process-functions" title="Permalink to this headline">¶</a></h3>
<p>The openEO Python Client Library defines the
official processes in the <code class="xref py py-mod docutils literal notranslate"><span class="pre">openeo.processes</span></code> module,
which can be used to build a process graph as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">openeo.processes</span> <span class="kn">import</span> <span class="n">subtract</span><span class="p">,</span> <span class="n">divide</span>
<span class="kn">from</span> <span class="nn">openeo.api.process</span> <span class="kn">import</span> <span class="n">Parameter</span>

<span class="c1"># Define the input parameter.</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Degrees Fahrenheit.&quot;</span><span class="p">)</span>

<span class="c1"># Do the calculations, using the parameter and other values</span>
<span class="n">fahrenheit_to_celsius</span> <span class="o">=</span> <span class="n">divide</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">subtract</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">f</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">32</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.8</span><span class="p">)</span>

<span class="c1"># Store user-defined process in openEO backend.</span>
<span class="n">connection</span><span class="o">.</span><span class="n">save_user_defined_process</span><span class="p">(</span>
    <span class="s2">&quot;fahrenheit_to_celsius&quot;</span><span class="p">,</span>
    <span class="n">fahrenheit_to_celsius</span><span class="p">,</span>
    <span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="n">f</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">fahrenheit_to_celsius</span></code> object encapsulates the subtract and divide calculations in a symbolic way.
We can pass it directly to <a class="reference internal" href="api.html#openeo.rest.connection.Connection.save_user_defined_process" title="openeo.rest.connection.Connection.save_user_defined_process"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save_user_defined_process()</span></code></a>.</p>
<p>If you want to inspect its openEO-style process graph representation,
use the <code class="docutils literal notranslate"><span class="pre">.flat_graph()</span></code> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">fahrenheit_to_celsius</span><span class="o">.</span><span class="n">flat_graph</span><span class="p">())</span>
<span class="go">{</span>
<span class="go">   &#39;subtract1&#39;: {&#39;process_id&#39;: &#39;subtract&#39;, &#39;arguments&#39;: {&#39;x&#39;: {&#39;from_parameter&#39;: &#39;f&#39;}, &#39;y&#39;: 32}},</span>
<span class="go">   &#39;divide1&#39;: {&#39;process_id&#39;: &#39;divide&#39;, &#39;arguments&#39;: {&#39;x&#39;: {&#39;from_node&#39;: &#39;subtract1&#39;}, &#39;y&#39;: 1.8}, &#39;result&#39;: True}</span>
<span class="go">}</span>
</pre></div>
</div>
</div>
<div class="section" id="from-a-parameterized-data-cube">
<span id="create-udp-parameterized-cube"></span><h3>From a parameterized data cube<a class="headerlink" href="#from-a-parameterized-data-cube" title="Permalink to this headline">¶</a></h3>
<p>It’s also possible to work with a <a class="reference internal" href="api.html#openeo.rest.datacube.DataCube" title="openeo.rest.datacube.DataCube"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataCube</span></code></a> directly
and parameterize it.
Let’s create, as a simple but functional example, a custom <code class="docutils literal notranslate"><span class="pre">load_collection</span></code>
with hardcoded collection id and band name
and a parameterized spatial extent (with default):</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">spatial_extent</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">(</span>
    <span class="n">name</span><span class="o">=</span><span class="s2">&quot;bbox&quot;</span><span class="p">,</span>
    <span class="n">schema</span><span class="o">=</span><span class="s2">&quot;object&quot;</span><span class="p">,</span>
    <span class="n">default</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;west&quot;</span><span class="p">:</span> <span class="mf">3.7</span><span class="p">,</span> <span class="s2">&quot;south&quot;</span><span class="p">:</span> <span class="mf">51.03</span><span class="p">,</span> <span class="s2">&quot;east&quot;</span><span class="p">:</span> <span class="mf">3.75</span><span class="p">,</span> <span class="s2">&quot;north&quot;</span><span class="p">:</span> <span class="mf">51.05</span><span class="p">,</span> <span class="s2">&quot;crs&quot;</span><span class="p">:</span> <span class="s2">&quot;EPSG:4326&quot;</span><span class="p">}</span>
<span class="p">)</span>

<span class="n">cube</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">load_collection</span><span class="p">(</span>
    <span class="s2">&quot;SENTINEL2_L2A_SENTINELHUB&quot;</span><span class="p">,</span>
    <span class="n">spatial_extent</span><span class="o">=</span><span class="n">spatial_extent</span><span class="p">,</span>
    <span class="n">bands</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;B04&quot;</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Note how we just can pass <a class="reference internal" href="api.html#openeo.api.process.Parameter" title="openeo.api.process.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a> objects as arguments
while building a <a class="reference internal" href="api.html#openeo.rest.datacube.DataCube" title="openeo.rest.datacube.DataCube"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataCube</span></code></a>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Not all <a class="reference internal" href="api.html#openeo.rest.datacube.DataCube" title="openeo.rest.datacube.DataCube"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataCube</span></code></a> methods/processes properly support
<a class="reference internal" href="api.html#openeo.api.process.Parameter" title="openeo.api.process.Parameter"><code class="xref py py-class docutils literal notranslate"><span class="pre">Parameter</span></code></a> arguments.
Please submit a bug report when you encounter missing or wrong parameterization support.</p>
</div>
<p>We can now store this as a user-defined process called “fancy_load_collection” on the backend:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">connection</span><span class="o">.</span><span class="n">save_user_defined_process</span><span class="p">(</span>
    <span class="s2">&quot;fancy_load_collection&quot;</span><span class="p">,</span>
    <span class="n">cube</span><span class="p">,</span>
    <span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="n">spatial_extent</span><span class="p">]</span>
<span class="p">)</span>
</pre></div>
</div>
<p>If you want to inspect its openEO-style process graph representation,
use the <code class="docutils literal notranslate"><span class="pre">.flat_graph()</span></code> method:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">cube</span><span class="o">.</span><span class="n">flat_graph</span><span class="p">())</span>
<span class="go">{&#39;loadcollection1&#39;: {&#39;process_id&#39;: &#39;load_collection&#39;, &#39;arguments&#39;: {</span>
<span class="go">&#39;id&#39;: &#39;SENTINEL2_L2A_SENTINELHUB&#39;, &#39;bands&#39;: [&#39;B04&#39;],</span>
<span class="go">&#39;spatial_extent&#39;: {&#39;from_parameter&#39;: &#39;bbox&#39;},</span>
<span class="go">&#39;temporal_extent&#39;: None}, &#39;result&#39;: True}}</span>
</pre></div>
</div>
</div>
<div class="section" id="using-a-predefined-dictionary">
<span id="create-udp-from-dict"></span><h3>Using a predefined dictionary<a class="headerlink" href="#using-a-predefined-dictionary" title="Permalink to this headline">¶</a></h3>
<p>In some (advanced) situation, you might already have
the process graph in dictionary format
(or JSON format, which is very close and easy to transform).
Another developer already prepared it for you,
or you prefer to fine-tune process graphs in a JSON editor.
It is very straightforward to submit this as a user-defined process.</p>
<p>Say we start from the following Python dictionary,
representing the Fahrenheit to Celsius conversion we discussed before:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">fahrenheit_to_celsius</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;subtract1&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;subtract&quot;</span><span class="p">,</span>
        <span class="s2">&quot;arguments&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;from_parameter&quot;</span><span class="p">:</span> <span class="s2">&quot;f&quot;</span><span class="p">},</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mi">32</span><span class="p">}</span>
    <span class="p">},</span>
    <span class="s2">&quot;divide1&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;divide&quot;</span><span class="p">,</span>
        <span class="s2">&quot;arguments&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;x&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;from_node&quot;</span><span class="p">:</span> <span class="s2">&quot;subtract1&quot;</span><span class="p">},</span> <span class="s2">&quot;y&quot;</span><span class="p">:</span> <span class="mf">1.8</span><span class="p">},</span>
        <span class="s2">&quot;result&quot;</span><span class="p">:</span> <span class="kc">True</span>
    <span class="p">}</span>
</pre></div>
</div>
<p>We can store this directly, taking into account that we have to define
a parameter named <code class="docutils literal notranslate"><span class="pre">f</span></code> corresponding with the <code class="docutils literal notranslate"><span class="pre">{&quot;from_parameter&quot;:</span> <span class="pre">&quot;f&quot;}</span></code> argument
from the dictionary above:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">connection</span><span class="o">.</span><span class="n">save_user_defined_process</span><span class="p">(</span>
    <span class="n">user_defined_process_id</span><span class="o">=</span><span class="s2">&quot;fahrenheit_to_celsius&quot;</span><span class="p">,</span>
    <span class="n">process_graph</span><span class="o">=</span><span class="n">fahrenheit_to_celsius</span><span class="p">,</span>
    <span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="n">Parameter</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Degrees Fahrenheit&quot;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="store-to-a-file">
<h3>Store to a file<a class="headerlink" href="#store-to-a-file" title="Permalink to this headline">¶</a></h3>
<p>Some use cases might require storing the user-defined process in,
for example, a JSON file instead of storing it directly on a backend.
Use <code class="xref py py-func docutils literal notranslate"><span class="pre">build_process_dict()</span></code> to build a dictionary
compatible with the “process graph with metadata” format of the openEO API
and dump it in JSON format to a file:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">from</span> <span class="nn">openeo.rest.udp</span> <span class="kn">import</span> <span class="n">build_process_dict</span>
<span class="kn">from</span> <span class="nn">openeo.processes</span> <span class="kn">import</span> <span class="n">subtract</span><span class="p">,</span> <span class="n">divide</span>
<span class="kn">from</span> <span class="nn">openeo.api.process</span> <span class="kn">import</span> <span class="n">Parameter</span>

<span class="n">fahrenheit</span> <span class="o">=</span> <span class="n">Parameter</span><span class="o">.</span><span class="n">number</span><span class="p">(</span><span class="s2">&quot;f&quot;</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Degrees Fahrenheit.&quot;</span><span class="p">)</span>
<span class="n">fahrenheit_to_celsius</span> <span class="o">=</span> <span class="n">divide</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">subtract</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">fahrenheit</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mi">32</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.8</span><span class="p">)</span>

<span class="n">spec</span> <span class="o">=</span> <span class="n">build_process_dict</span><span class="p">(</span>
    <span class="n">process_id</span><span class="o">=</span><span class="s2">&quot;fahrenheit_to_celsius&quot;</span><span class="p">,</span>
    <span class="n">process_graph</span><span class="o">=</span><span class="n">fahrenheit_to_celsius</span><span class="p">,</span>
    <span class="n">parameters</span><span class="o">=</span><span class="p">[</span><span class="n">fahrenheit</span><span class="p">]</span>
<span class="p">)</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;fahrenheit_to_celsius.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">spec</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
</pre></div>
</div>
<p>This results in a JSON file like this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="p">{</span>
  <span class="s2">&quot;id&quot;</span><span class="p">:</span> <span class="s2">&quot;fahrenheit_to_celsius&quot;</span><span class="p">,</span>
  <span class="s2">&quot;process_graph&quot;</span><span class="p">:</span> <span class="p">{</span>
    <span class="s2">&quot;subtract1&quot;</span><span class="p">:</span> <span class="p">{</span>
      <span class="s2">&quot;process_id&quot;</span><span class="p">:</span> <span class="s2">&quot;subtract&quot;</span><span class="p">,</span>
       <span class="o">...</span>
  <span class="s2">&quot;parameters&quot;</span><span class="p">:</span> <span class="p">[</span>
    <span class="p">{</span>
      <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="s2">&quot;f&quot;</span><span class="p">,</span>
      <span class="o">...</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="evaluate-user-defined-processes">
<h2>Evaluate user-defined processes<a class="headerlink" href="#evaluate-user-defined-processes" title="Permalink to this headline">¶</a></h2>
<p>Let’s evaluate the user-defined processes we defined.</p>
<p>Because there is no pre-defined
wrapper function for our user-defined process, we use the
generic <code class="xref py py-func docutils literal notranslate"><span class="pre">openeo.processes.process()</span></code> function to build a simple
process graph that calls our <code class="docutils literal notranslate"><span class="pre">fahrenheit_to_celsius</span></code> process:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="n">pg</span> <span class="o">=</span> <span class="n">openeo</span><span class="o">.</span><span class="n">processes</span><span class="o">.</span><span class="n">process</span><span class="p">(</span><span class="s2">&quot;fahrenheit_to_celsius&quot;</span><span class="p">,</span> <span class="n">f</span><span class="o">=</span><span class="mi">70</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">flat_graph</span><span class="p">())</span>
<span class="go">{&#39;fahrenheittocelsius1&#39;: {&#39;process_id&#39;: &#39;fahrenheit_to_celsius&#39;, &#39;arguments&#39;: {&#39;f&#39;: 70}, &#39;result&#39;: True}}</span>

<span class="gp">&gt;&gt;&gt; </span><span class="n">res</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">pg</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
<span class="go">21.11111111111111</span>
</pre></div>
</div>
<p>To use our custom <code class="docutils literal notranslate"><span class="pre">fancy_load_collection</span></code> process,
we only have to specify a temporal extent,
and let the predefined and default values do their work.
We will use <a class="reference internal" href="api.html#openeo.rest.connection.Connection.datacube_from_process" title="openeo.rest.connection.Connection.datacube_from_process"><code class="xref py py-func docutils literal notranslate"><span class="pre">datacube_from_process()</span></code></a>
to construct a <a class="reference internal" href="api.html#openeo.rest.datacube.DataCube" title="openeo.rest.datacube.DataCube"><code class="xref py py-class docutils literal notranslate"><span class="pre">DataCube</span></code></a> object
which we can process further and download:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">cube</span> <span class="o">=</span> <span class="n">connection</span><span class="o">.</span><span class="n">datacube_from_process</span><span class="p">(</span><span class="s2">&quot;fancy_load_collection&quot;</span><span class="p">)</span>
<span class="n">cube</span> <span class="o">=</span> <span class="n">cube</span><span class="o">.</span><span class="n">filter_temporal</span><span class="p">(</span><span class="s2">&quot;2020-09-01&quot;</span><span class="p">,</span> <span class="s2">&quot;2020-09-10&quot;</span><span class="p">)</span>
<span class="n">cube</span><span class="o">.</span><span class="n">download</span><span class="p">(</span><span class="s2">&quot;fancy.tiff&quot;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s2">&quot;GTiff&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="public-user-defined-processes">
<h2>Public user-defined processes<a class="headerlink" href="#public-user-defined-processes" title="Permalink to this headline">¶</a></h2>
<p>To make your process usable by other users, you can set the ‘public’ flag
in <a class="reference internal" href="api.html#openeo.rest.connection.Connection.save_user_defined_process" title="openeo.rest.connection.Connection.save_user_defined_process"><code class="xref py py-meth docutils literal notranslate"><span class="pre">save_user_defined_process()</span></code></a> to <code class="docutils literal notranslate"><span class="pre">True</span></code>.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Beta feature - while the support for storing processes is defined in the API, there is
still some work ongoing concerning how to publicly share those processes, so this is subject
to small changes in the future. Nevertheless, we foresee that this support will be further improved.
Related <a class="reference external" href="https://github.com/Open-EO/openeo-api/issues/310">issue</a>.</p>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2017 - 2021, Jeroen Dries.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 3.5.3</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/udp.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    
    <a href="https://github.com/Open-EO/openeo-python-client" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

    
  </body>
</html>